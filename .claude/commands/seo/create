#!/usr/bin/env node

/**
 * SEO Article Create Command
 * Usage: create [G-ID] [content-number]
 */

const path = require('path');
const fs = require('fs');

// SEOã‚·ã‚¹ãƒ†ãƒ ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ±ºå®š
const SEO_SYSTEM_ROOT = process.env.SEO_SYSTEM_ROOT || 
    (fs.existsSync('/home/general/seo-article-system') ? '/home/general/seo-article-system' : 
     path.resolve(process.cwd(), 'seo-article-system'));

if (!fs.existsSync(SEO_SYSTEM_ROOT)) {
    console.error('âŒ SEOã‚·ã‚¹ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
    console.error('   ã¾ãš setup ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
    process.exit(1);
}

// SEOã‚³ãƒãƒ³ãƒ‰ã‚’å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰
const SEOCommands = require(path.join(SEO_SYSTEM_ROOT, 'tools', 'seo_commands.js'));
const seoCommands = new SEOCommands();

async function main() {
    const args = process.argv.slice(2);
    
    if (args.length < 2) {
        console.log(`
âœï¸ SEO Create ã‚³ãƒãƒ³ãƒ‰

ä½¿ç”¨æ–¹æ³•:
  create [G-ID] [ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç•ªå·]

ä¾‹:
  create G0016374 01
  create G0016374 02
        `);
        process.exit(0);
    }

    const [gid, contentNumber] = args;
    console.log(`ğŸ¯ è¨˜äº‹ä½œæˆ: G-ID=${gid}, ã‚³ãƒ³ãƒ†ãƒ³ãƒ„=${contentNumber}`);
    
    try {
        const result = await seoCommands.create(gid, contentNumber);
        if (result.success) {
            console.log(`âœ… è¨˜äº‹ä½œæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†`);
            console.log(`ğŸ“„ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: ${result.promptsPath}`);
            console.log(`ğŸ“ å‡ºåŠ›å…ˆ: ${result.outputDir}`);
            console.log(`\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:`);
            console.log(`  1. ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§è¨˜äº‹ã‚’ä½œæˆ`);
            console.log(`  2. validate "/path/to/generated_article.md"`);
        } else {
            console.error(`âŒ è¨˜äº‹ä½œæˆå¤±æ•—: ${result.error}`);
            process.exit(1);
        }
    } catch (error) {
        console.error(`âŒ å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
        process.exit(1);
    }
}

if (require.main === module) {
    main();
}